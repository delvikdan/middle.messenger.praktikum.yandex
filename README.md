# Icewind Chat

Одностраничное веб-приложение (SPA) — мессенджер, реализованный на TypeScript c использованием собственного компонентного фреймворка.

Реализованы аутентификация, профиль, список чатов, сообщения, валидация входных данных и все базовые сценарии современного мессенджера.

# Стек и используемые технологии:

- TypeScript — строгая типизация, современный синтаксис.
- Собственный компонентный фреймворк — классы Block, EventBus, реализующие жизненный цикл, прокидывание пропсов и событийную архитектуру React-подобного типа.
- Handlebars — шаблонизатор для декларативного описания разметки (интерполяция данных, циклы, сравнения в шаблоне, частичные шаблоны).
- SCSS — стили по методологии 7-1, модульная структура стилей.
- ESLint, Prettier, Stylelint — поддержка чистоты и читаемости кода.
- Vite — сборка и локальный сервер.

# Особенности архитектуры:

## API-слой

- Изолированный слой API для всех сетевых запросов: api/user.ts, api/chat.ts, api/auth.ts
- Каждый модуль реализует методы для получения, изменения, отправки данных (getUser, findUser, addUsers, getChats, sendMessage и др.).
- Единая точка конфигурации (базовый URL, токены).
- Все методы API ничего не знают о бизнес-логике приложения, возвращают "сырые" структуры.

## Контроллеры

- Контроллеры (UserController, ChatController, MessagesWSController) — реализуют бизнес-логику работы с API и хранилищем, отвечают за обработку ошибок, форматирование данных, вызов side effects.
- Контроллеры вызываются только из компонентов (по событиям пользователей).
- В контроллерах инкапсулирована вся работа с асинхронными действиями, хранением, проверками и преобразованием данных для UI.

## Хранилище (Store)

- Глобальное хранилище (store) — реализует хранение состояния, подписку и оповещение компонентов об изменениях.
- Поддерживает реактивное обновление (connect — HOC для проброса данных из store в компоненты).
- Все основные данные ("пользователь", "чаты", "сообщения", "юзеры чата", и т.д.) — единая точка правды.

## WebSocket-контроллер

- MessagesWSController — отдельная реализация работы с websocket-подключением к серверу обмена сообщениями.
- Поддержка многократного открытия/закрытия сокета, слежение за статусом, обработка входящих/исходящих сообщений, обновление store.
- Позволяет мгновенно синхронизировать историю чата между пользователями.

## Компоненты

- Все UI-элементы (инпуты, кнопки, списки, формы, аватарки, чатовые сообщения, header, sidebar, и т.д.) реализованы наследниками базового класса Block.
- Каждый компонент работает только на своих props и children, отделён от глобального состояния (кроме через connect).
- Жизненный цикл компонентов (mount, update, render, destroy) управляется через EventBus.

## Валидация

- Валидация всех форм выведена в отдельные хелперы и проставляется на уровне Input-компонента.
- Ошибки валидации отображаются как в UI, так и выводятся в консоль (для разработчика).

## Маршрутизация

- Весь роутинг реализован собственным мини-Router: маршруты ("/", "/chat", "/settings", "/login", др.) — отдельные компоненты, SPA навигация без перезагрузки страницы.

# Возможности:

- Регистрация/авторизация — защищённые роуты, автоматический редирект, валидация.
- Профиль пользователя — просмотр и редактирование, смена пароля/аватара/данных.
- Список чатов с последними сообщениями и превью.
- Отправка, просмотр и автоскролл истории сообщений.
- Добавление/удаление пользователей из чата.
- Полная фронтовая логика обмена сообщениями через WebSocket-канал.
- Сообщения мгновенно попадают в историю чата.
- Компонентная структура и единый подход к стилям.
- Формы редактирования профиля и пароля с валидацией.

# Тестирование

- Юнит-тесты запускаются через команду `npm run test` и реализованы с использованием Mocha, Chai и Sinon. Благодаря окружению jsdom компоненты можно тестировать без запуска настоящего браузера.
- Конфигурационный файл .mocharc.json настроен на автоматический поиск и запуск всех файлов с тестами (\*.test.ts) в директории src/. Для поддержки TypeScript в тестах применяется модульная загрузка через ts-node/esm.
- В проекте подключён инструмент husky, который автоматически запускает проверки (например, запуск тестов или линтеров) перед фиксацией изменений в git с помощью pre-commit-хуков, предотвращая попадание невалидного кода в репозиторий.

# Дизайн

За основу дизайна взят следующий макет:

https://www.figma.com/design/jF5fFFzgGOxQeB4CmKWTiE/Chat_external_link?node-id=0-1&p=f&t=tZJlEtX5CIV7wdQe-0

# Установка

Установить зависимости проекта:

`npm install`

Собрать проект:

`npm run build`

Запустить проект на localhost:

`npm run start`

Запустить Eslint, Stylelint:

`npm run lint`

`npm run lint:style `

Запустить unit-тесты:

`npm run test`

# Ссылки:

### На веб-приложение:

Netlify: https://icewind-chat.netlify.app/
